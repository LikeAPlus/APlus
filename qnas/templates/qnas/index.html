{% extends "qnas/layout.html" %}

{% load static %}

{% block title %}
    APlus
{% endblock %}

{% block menu %}

    <!-- Search -->
    <section class="search">
        <form>
            <div class="input-group">
                <input type="text" class="form-control" placeholder="학과 검색" aria-describedby="btnGroupAddon">
                <span class="input-group-addon" id="btnGroupAddon">
		  		<a href="#"><i class="fa fa-search" aria-hidden="true"></i></a>
		  	</span>
            </div>
        </form>

        {% for major in majors %}
            {% if major.name == major_name %}
                <a href="/qnas/{{ major.e_name }}"><span class="name">{{ major.name }}</span></a>
            {% else %}
                <a href="/qnas/{{ major.e_name }}"><span class="name">{{ major.name }}</span></a>
            {% endif %}
        {% endfor %}
    </section>

    <section class="search">
        <form>
            <div class="input-group">
                <input type="text" class="form-control" placeholder="과목 검색" aria-describedby="btnGroupAddon">
                <span class="input-group-addon" id="btnGroupAddon">
		  		<a href="#"><i class="fa fa-search" aria-hidden="true"></i></a>
		  	</span>
            </div>
        </form>

        {% if major_name != "" %}
            {% for course in courses %}
                {% if course.name == course_name %}
                    <a href="/qnas/{{ major_name }}/{{ course.e_name }}"><span class="name">{{ course.name }}</span></a>
                {% else %}
                    <a href="/qnas/{{ major_name }}/{{ course.e_name }}"><span class="name">{{ course.name }}</span></a>
                {% endif %}
            {% endfor %}
        {% endif %}
    </section>
{% endblock %}

{% block content %}
    <section class="search2">
        <div class="row">
            <div class="input-group col-md-10">
                <input type="text" class="form-control" placeholder="질문 검색" aria-describedby="btnGroupAddon">
                <span class="input-group-addon" id="btnGroupAddon">
		  		<a href="#"><i class="fa fa-search" aria-hidden="true"></i></a>
		  	</span>
            </div>

            {#        <a href="{% url 'qnas:create' %}">글 작성</a>#}
            <div class="input-group col-md-1">
            <span class="input-group-btn">
                {% if course_name != '' %}
                    <button class="btn btn-secondary" type="button" data-toggle="modal" data-target="#myModal">
                {% else %}
                    <button class="btn btn-secondary" type="button" data-toggle="modal" data-target="#myModal"
                            onclick="selectMajor()">
                {% endif %}
                <i class="fa fa-pencil" aria-hidden="true"> 글 작성</i>
                </button>
	      </span>
            </div>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
             aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">
                            <i class="fa fa-pencil" aria-hidden="true"></i>
                            게시물 작성
                        </h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>

                    <form action="{% url "qnas:create" %}" method="post" enctype="multipart/form-data">
                        <div class="modal-body">
                            {% csrf_token %}
                            <div>
                                <input name="title" class="form-control">
                            </div>
                            <div>
                                <textarea class="form-control" name="content" placeholder="글을 작성해주세요!"></textarea>
                            </div>

                            <select id="majorselect" name="major" onchange="selectMajor();">
                                {% for major in majors %}
                                    {% if major_name == major.e_name %}
                                        <option value="{{ major.id }}" selected>{{ major.name }}</option>
                                    {% else %}
                                        <option value="{{ major.id }}">{{ major.name }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>

                            <select id="courseselect" name="course">
                                {% for course in courses %}
                                    {% if course_name == course.e_name %}
                                        <option value="{{ course.id }}" selected>{{ course.name }}</option>
                                    {% else %}
                                        <option value="{{ course.id }}">{{ course.name }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            <!-- <div class="form-group">
                              <input type="file" name="image" accept="image/*">
                            </div> -->
                        </div>
                        <div class="modal-footer d-flex justify-content-start" style="height: 50px;width: 100%">

                            <div class="p-2"><img src="/static/qnas/hashtag.png" alt="hashtag" style="width:15px"
                                                  class="modal_hashtag"></div>
                            <div class="p-2"><img src="/static/qnas/paperclip.png" alt="paperclip" style="width:15px"
                                                  class="modal_paperclip"></div>
                            <div class="ml-auto p-2">
                                <button type="submit" class="btn btn-warning">게시</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <script>
            (function () {
                $('#myModal').modal('show');
            })();
        </script>
        <!--
                <form class="write">
                    <div class="form-group">
                        <input name = "title" placeholder="title" class="title">
                        <textarea class="form-control" id="exampleFormControlTextarea1" rows="10"></textarea>

                        <label class="btn btn-default">
                          UPLOAD<input type="file" hidden>
                        </label>

                        <label class="btn btn-default submit">
                          UPLOAD<input type="submit" hidden>
                        </label>

        </div>
        </form>-->

        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab"
                   aria-controls="home"
                   aria-expanded="true">최신</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab"
                   aria-controls="profile">인기</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab"
                   aria-controls="profile">답변필요</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab"
                   aria-controls="profile">태그선택</a>
            </li>

        </ul>
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                {% for post in posts %}
                    <h1><a href="/qnas/read/{{ post.id }}">{{ post.title }}</a></h1>
                    <p>{{ post.user }}</p>
                    <p>{{ post.major }}</p>
                    <p>{{ post.course }}</p>
                    <p>{{ post.content }}</p>

                {% endfor %}
            </div>
            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">...</div>
            <div class="tab-pane fade" id="dropdown1" role="tabpanel" aria-labelledby="dropdown1-tab">...</div>
            <div class="tab-pane fade" id="dropdown2" role="tabpanel" aria-labelledby="dropdown2-tab">...</div>
        </div>
    </section>

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"
            integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
            crossorigin="anonymous"></script>

    <script>
        function selectMajor() {
            var major_name = $("#majorselect :selected").text();
            var url = "/qnas/read_courses/" + major_name + "/";
            $.ajax({
                type: "GET",
                url: url,
                dataType: "json",
                success: function (data) {
                    $("#courseselect").empty();
                    $(data.courses).each(function (i, e) {
                        var item = '<option value="' + e.id + '">' + e.name + '</option>';
                        $("#courseselect").append(item);
                    });
                }
            });
        }
    </script>
{% endblock %}
